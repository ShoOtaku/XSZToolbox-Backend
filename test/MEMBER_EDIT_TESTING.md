# 成员列表可编辑功能测试指南

## 功能概述

本功能允许管理员在房间详情模态框中直接编辑成员的职能标识和权限角色。

## 实现的功能

### 1. 职能标识下拉菜单
- 管理员可以通过下拉菜单修改成员的职能标识
- 可选项：MT, ST, H1, H2, D1, D2, D3, D4, 无
- 普通用户只能查看，不能编辑

### 2. 权限角色下拉菜单
- 管理员可以通过下拉菜单修改成员的权限角色
- 可选项：队长 (Leader), 成员 (Member)
- 房主 (Host) 的权限不可修改
- 普通用户只能查看，不能编辑

## 手动测试步骤

### 前置条件
1. 以管理员身份登录管理面板
2. 确保有至少一个活跃的房间，且房间内有多个成员

### 测试场景 1: 修改成员职能标识

**步骤：**
1. 在房间管理页面，点击任意房间行查看详情
2. 在成员列表中，找到任意非房主成员
3. 点击"职业"列的下拉菜单
4. 选择一个新的职能标识（例如：MT）
5. 观察页面反馈

**预期结果：**
- 下拉菜单在提交时被禁用
- 显示"职能已更新"的成功提示
- 下拉菜单的值保持为新选择的值
- 下拉菜单重新启用

**失败场景测试：**
1. 断开网络连接
2. 尝试修改职能标识
3. 观察页面反馈

**预期结果：**
- 显示错误提示
- 下拉菜单的值恢复为原始值
- 下拉菜单重新启用

### 测试场景 2: 修改成员权限角色

**步骤：**
1. 在房间详情的成员列表中，找到任意非房主成员
2. 点击"权限"列的下拉菜单
3. 选择一个新的权限角色（例如：队长）
4. 观察页面反馈

**预期结果：**
- 下拉菜单在提交时被禁用
- 显示"权限已更新"的成功提示
- 下拉菜单的值保持为新选择的值
- 下拉菜单重新启用

### 测试场景 3: 房主权限保护

**步骤：**
1. 在房间详情的成员列表中，找到房主成员
2. 观察房主的权限列

**预期结果：**
- 房主的权限显示为"房主"
- 权限列不是下拉菜单，而是静态文本
- 无法修改房主的权限

### 测试场景 4: 普通用户权限限制

**步骤：**
1. 以普通用户（viewer）身份登录
2. 进入房间管理页面
3. 点击任意房间查看详情
4. 观察成员列表

**预期结果：**
- 职能和权限列显示为静态文本
- 没有下拉菜单
- 无法编辑任何成员信息

## 自动化测试

运行以下命令执行自动化测试：

```bash
cd XSZToolbox-Backend
node test/memberEditFeature.test.js
```

## 验证的属性

### 属性 1: 职能更新 API 调用
对于任何有效的房间ID、成员CID哈希和职能标识，当管理员选择新职能时，系统应该调用职能更新API。

**验证需求：** 2.3

### 属性 2: 职能更新成功后 UI 同步
对于任何职能更新成功的响应，界面上显示的职能标识应该与新选择的职能一致。

**验证需求：** 2.4

### 属性 3: 职能更新失败后状态恢复
对于任何职能更新失败的响应，界面上显示的职能标识应该恢复到更新前的原始值。

**验证需求：** 2.5

### 属性 4: 权限更新 API 调用
对于任何有效的房间ID、非房主成员CID哈希和权限角色，当管理员选择新权限时，系统应该调用权限更新API。

**验证需求：** 3.4

### 属性 5: 权限更新成功后 UI 同步
对于任何权限更新成功的响应，界面上显示的权限角色应该与新选择的权限一致。

**验证需求：** 3.5

## 已知限制

1. 修改操作是即时生效的，没有批量修改功能
2. 没有修改历史记录
3. 没有撤销功能

## 相关文件

- 前端实现：`XSZToolbox-Backend/admin-panel/js/app.js`
- API 客户端：`XSZToolbox-Backend/admin-panel/js/api.js`
- 样式文件：`XSZToolbox-Backend/admin-panel/css/style.css`
- 后端 API：`XSZToolbox-Backend/src/controllers/remoteController.js`
- 数据模型：`XSZToolbox-Backend/src/models/roomModel.js`

## 故障排除

### 问题：下拉菜单不显示
**解决方案：** 确保以管理员身份登录

### 问题：修改后没有反馈
**解决方案：** 检查浏览器控制台是否有错误，确认后端 API 正常运行

### 问题：修改失败
**解决方案：** 
1. 检查网络连接
2. 确认后端服务正在运行
3. 查看后端日志文件
4. 确认数据库连接正常
