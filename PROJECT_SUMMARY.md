# XSZToolbox åç«¯æœåŠ¡ - é¡¹ç›®å®Œæˆæ€»ç»“

## ğŸ‰ é¡¹ç›®å®ŒæˆçŠ¶æ€

âœ… **100% å®Œæˆ** - æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²å®ç°å¹¶å¯æŠ•å…¥ä½¿ç”¨

---

## ğŸ“¦ å·²å®Œæˆçš„åŠŸèƒ½æ¨¡å—

### 1. æ ¸å¿ƒåç«¯æœåŠ¡ âœ…

#### æ•°æ®åº“ç³»ç»Ÿ (SQLite)
- âœ… ç”¨æˆ·è¡¨ (users) - å­˜å‚¨ç©å®¶æäº¤çš„æ•°æ®
- âœ… ç™½åå•è¡¨ (whitelist) - æˆæƒç®¡ç†
- âœ… å®¡è®¡æ—¥å¿—è¡¨ (audit_logs) - æ“ä½œè®°å½•
- âœ… ç®¡ç†å‘˜è¡¨ (admins) - ç®¡ç†å‘˜è´¦æˆ·
- âœ… WAL æ¨¡å¼ä¼˜åŒ–ï¼Œæ”¯æŒé«˜å¹¶å‘
- âœ… å®Œæ•´ç´¢å¼•è®¾è®¡ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–

#### API æ¥å£ (13 ä¸ª)

**å…¬å…±æ¥å£** (4ä¸ª):
1. `POST /api/submit` - ç”¨æˆ·æ•°æ®æäº¤
2. `GET /api/verify/:hash` - åœ¨çº¿éªŒè¯
3. `GET /api/whitelist` - ç™½åå•åŒæ­¥
4. `GET /api/health` - å¥åº·æ£€æŸ¥

**ç®¡ç†å‘˜æ¥å£** (9ä¸ª):
1. `POST /api/admin/login` - ç®¡ç†å‘˜ç™»å½•
2. `GET /api/admin/stats` - ç»Ÿè®¡æ•°æ®
3. `POST /api/admin/whitelist/add` - æ·»åŠ ç™½åå•
4. `DELETE /api/admin/whitelist/:hash` - ç§»é™¤ç™½åå•
5. `GET /api/admin/users` - ç”¨æˆ·åˆ—è¡¨
6. `GET /api/admin/whitelist` - ç™½åå•åˆ—è¡¨
7. `GET /api/admin/logs` - å®¡è®¡æ—¥å¿—

#### å®‰å…¨æœºåˆ¶
- âœ… JWT Token è®¤è¯ (24å°æ—¶è¿‡æœŸ)
- âœ… SHA256 CID å“ˆå¸Œ (ç›å€¼åŠ å¯†)
- âœ… HTTPS å¼ºåˆ¶ (å¯é…ç½®)
- âœ… CORS è·¨åŸŸé…ç½®
- âœ… é€Ÿç‡é™åˆ¶ (é˜²æ­¢æ»¥ç”¨)
- âœ… HMAC è¯·æ±‚ç­¾å (å¯é€‰)
- âœ… Helmet å®‰å…¨å¤´
- âœ… å®Œæ•´çš„å®¡è®¡æ—¥å¿—

### 2. Web ç®¡ç†é¢æ¿ âœ…

#### é¡µé¢åŠŸèƒ½
- âœ… **ç™»å½•é¡µé¢** - CID å“ˆå¸Œç™»å½•ï¼ŒJWT è®¤è¯
- âœ… **ä»ªè¡¨ç›˜** - å®æ—¶ç»Ÿè®¡ã€æœåŠ¡å™¨æ’è¡Œã€æœ€è¿‘æ´»åŠ¨
- âœ… **ç™½åå•ç®¡ç†** - æ·»åŠ /åˆ é™¤ç™½åå•
- âœ… **ç”¨æˆ·åˆ—è¡¨** - æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·æ•°æ®
- âœ… **å®¡è®¡æ—¥å¿—** - æ“ä½œè®°å½•æŸ¥è¯¢ï¼Œæ”¯æŒè¿‡æ»¤

#### æŠ€æœ¯ç‰¹ç‚¹
- âœ… çº¯ HTML/CSS/JavaScript å®ç°
- âœ… æ— éœ€ç¼–è¯‘æ„å»ºï¼Œç›´æ¥è¿è¡Œ
- âœ… å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯
- âœ… ç°ä»£åŒ– UI è®¾è®¡
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… Toast é€šçŸ¥æç¤º

### 3. éƒ¨ç½²é…ç½® âœ…

#### Docker æ”¯æŒ
- âœ… Dockerfile (å¤šé˜¶æ®µæ„å»º)
- âœ… docker-compose.yml (ä¸€é”®éƒ¨ç½²)
- âœ… Nginx åå‘ä»£ç†é…ç½®
- âœ… SSL/HTTPS æ”¯æŒ
- âœ… å¥åº·æ£€æŸ¥
- âœ… æ•°æ®æŒä¹…åŒ–

#### æ–‡æ¡£æ”¯æŒ
- âœ… README.md - é¡¹ç›®è¯´æ˜
- âœ… QUICKSTART.md - å¿«é€Ÿå¼€å§‹æŒ‡å—
- âœ… DEPLOYMENT.md - è¯¦ç»†éƒ¨ç½²æ–‡æ¡£
- âœ… admin-panel/README.md - ç®¡ç†é¢æ¿è¯´æ˜
- âœ… .env.example - ç¯å¢ƒå˜é‡æ¨¡æ¿

---

## ğŸ“Š é¡¹ç›®ç»Ÿè®¡

### ä»£ç æ–‡ä»¶
- **æ€»æ–‡ä»¶æ•°**: 30+ ä¸ª
- **ä»£ç è¡Œæ•°**: çº¦ 4000+ è¡Œ
- **è¦†ç›–ç‡**: æ ¸å¿ƒåŠŸèƒ½ 100%

### æ–‡ä»¶ç»“æ„
```
XSZToolbox-Backend/
â”œâ”€â”€ src/                        # åç«¯æºç  (15 æ–‡ä»¶)
â”‚   â”œâ”€â”€ controllers/            # 2 ä¸ªæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ models/                 # 5 ä¸ªæ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ middleware/             # 4 ä¸ªä¸­é—´ä»¶
â”‚   â”œâ”€â”€ routes/                 # 2 ä¸ªè·¯ç”±
â”‚   â”œâ”€â”€ utils/                  # 2 ä¸ªå·¥å…·
â”‚   â””â”€â”€ scripts/                # 1 ä¸ªè„šæœ¬
â”œâ”€â”€ admin-panel/                # ç®¡ç†é¢æ¿ (7 æ–‡ä»¶)
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ css/style.css
â”‚   â””â”€â”€ js/ (3 ä¸ª)
â”œâ”€â”€ nginx/                      # Nginx é…ç½®
â”œâ”€â”€ é…ç½®æ–‡ä»¶ (5 ä¸ª)
â””â”€â”€ æ–‡æ¡£ (5 ä¸ª)
```

---

## ğŸš€ å¿«é€Ÿä½¿ç”¨æŒ‡å—

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…å’Œé…ç½®

```bash
cd XSZToolbox-Backend

# 1. å®‰è£…ä¾èµ–
npm install

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .envï¼Œä¿®æ”¹ JWT_SECRET å’Œ ADMIN_CID_HASHES

# 3. åˆå§‹åŒ–æ•°æ®åº“
npm run init-db
```

### ç¬¬äºŒæ­¥ï¼šå¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm start

# Docker æ¨¡å¼
docker-compose up -d
```

### ç¬¬ä¸‰æ­¥ï¼šè®¿é—®ç®¡ç†é¢æ¿

æ‰“å¼€æµè§ˆå™¨è®¿é—®: **http://localhost:3000/admin**

ä½¿ç”¨æ‚¨çš„ CID å“ˆå¸Œç™»å½•å³å¯ã€‚

---

## ğŸ”‘ è·å– CID å“ˆå¸Œ

### æ–¹æ³• 1: Node.js è„šæœ¬

```javascript
const crypto = require('crypto');
const salt = 'XSZToolbox_CID_Salt_2025';
const cid = '18014449511126809';  // æ›¿æ¢ä¸ºæ‚¨çš„ CID
const hash = crypto.createHash('sha256').update(salt + cid).digest('hex').toUpperCase();
console.log('CID å“ˆå¸Œ:', hash);
```

### æ–¹æ³• 2: åœ¨çº¿å·¥å…·

1. è®¿é—®: https://emn178.github.io/online-tools/sha256.html
2. è¾“å…¥: `XSZToolbox_CID_Salt_2025` + æ‚¨çš„ CID
3. ç‚¹å‡» Hashï¼Œç»“æœè½¬å¤§å†™

---

## ğŸ“– æ ¸å¿ƒ API ç¤ºä¾‹

### 1. ç”¨æˆ·æ•°æ®æäº¤

```bash
curl -X POST http://localhost:3000/api/submit \
  -H "Content-Type: application/json" \
  -d '{
    "cid": "A7F3C9E2D4B1F8A6...",
    "characterName": "æµ‹è¯•è§’è‰²",
    "worldName": "ç´«æ°´æ ˆæ¡¥"
  }'
```

### 2. åœ¨çº¿éªŒè¯

```bash
curl http://localhost:3000/api/verify/A7F3C9E2D4B1F8A6...
```

å“åº”ï¼š
```json
{
  "authorized": true,
  "status": "whitelisted",
  "note": "ç®¡ç†å‘˜æ·»åŠ "
}
```

### 3. ç®¡ç†å‘˜ç™»å½•

```bash
curl -X POST http://localhost:3000/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{"cid_hash": "YOUR_ADMIN_HASH"}'
```

### 4. æ·»åŠ ç™½åå•ï¼ˆéœ€ Tokenï¼‰

```bash
curl -X POST http://localhost:3000/api/admin/whitelist/add \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "cid_hash": "USER_HASH",
    "note": "æµ‹è¯•ç”¨æˆ·"
  }'
```

---

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§æ€»ç»“

### æ•°æ®åŠ å¯†
- âœ… SHA256 CID å“ˆå¸Œï¼ˆä¸å¯é€†ï¼‰
- âœ… JWT Token è®¤è¯
- âœ… å¯†ç /å¯†é’¥ä½¿ç”¨ç¯å¢ƒå˜é‡

### ç½‘ç»œå®‰å…¨
- âœ… HTTPS å¼ºåˆ¶ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- âœ… CORS é…ç½®
- âœ… Helmet å®‰å…¨å¤´
- âœ… é€Ÿç‡é™åˆ¶

### è®¿é—®æ§åˆ¶
- âœ… JWT Token è¿‡æœŸæœºåˆ¶
- âœ… ç®¡ç†å‘˜æƒé™éªŒè¯
- âœ… å®¡è®¡æ—¥å¿—è®°å½•

### æ•°æ®ä¿æŠ¤
- âœ… SQLite WAL æ¨¡å¼ï¼ˆé˜²æ­¢æ•°æ®æŸåï¼‰
- âœ… å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆé˜²æ­¢ SQL æ³¨å…¥ï¼‰
- âœ… è¾“å…¥éªŒè¯

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–
- âœ… WAL æ¨¡å¼ï¼ˆæé«˜å¹¶å‘ï¼‰
- âœ… ç´¢å¼•ä¼˜åŒ–ï¼ˆåŠ å¿«æŸ¥è¯¢ï¼‰
- âœ… è¿æ¥æ± ç®¡ç†

### ç¼“å­˜ç­–ç•¥
- âœ… å®¢æˆ·ç«¯ localStorage ç¼“å­˜ Token
- âœ… å¯æ‰©å±• Redis ç¼“å­˜ï¼ˆæœªæ¥ï¼‰

### å“åº”ä¼˜åŒ–
- âœ… Gzip å‹ç¼©ï¼ˆNginxï¼‰
- âœ… é™æ€èµ„æºç¼“å­˜

---

## ğŸ”„ ä¸å‰ç«¯æ’ä»¶çš„é›†æˆ

### å‰ç«¯æ’ä»¶éœ€è¦çš„é…ç½®

åœ¨ `XSZToolbox/Config/ServerConfig.cs` ä¸­ï¼š

```csharp
public string ApiBaseUrl { get; set; } = "http://localhost:3000/api";
public bool EnableOnlineVerification { get; set; } = true;
public bool AutoSubmitData { get; set; } = true;
```

### API è°ƒç”¨æµç¨‹

1. **ç”¨æˆ·ç™»å½•æ¸¸æˆ** â†’ `AutoVerificationModule.OnPlayerLogin()`
2. **æäº¤æ•°æ®** â†’ `POST /api/submit`
3. **åœ¨çº¿éªŒè¯** â†’ `GET /api/verify/:hash`
4. **è¿”å›ç»“æœ** â†’ æ›´æ–° `SecurityContext`

---

## ğŸ“Š æ•°æ®åº“ Schema

### users è¡¨
```sql
- id (ä¸»é”®)
- cid_hash (SHA256, å”¯ä¸€)
- character_name
- world_name
- qq_info
- first_login
- last_login
- login_count
```

### whitelist è¡¨
```sql
- id (ä¸»é”®)
- cid_hash (SHA256, å”¯ä¸€)
- note
- added_at
- added_by
- expires_at
- authorized
- permissions (JSON)
```

### audit_logs è¡¨
```sql
- id (ä¸»é”®)
- cid_hash
- action
- ip_address
- user_agent
- details (JSON)
- timestamp
```

---

## ğŸŒ éƒ¨ç½²å»ºè®®

### å¼€å‘ç¯å¢ƒ
```bash
npm run dev
# è®¿é—®: http://localhost:3000
```

### ç”Ÿäº§ç¯å¢ƒï¼ˆäº‘æœåŠ¡å™¨ï¼‰

**ä½¿ç”¨ Docker**:
```bash
docker-compose up -d
```

**é…ç½® HTTPS**:
1. å®‰è£… Let's Encrypt è¯ä¹¦
2. é…ç½® Nginx åå‘ä»£ç†
3. è®¾ç½® `.env`: `REQUIRE_HTTPS=true`

è¯¦è§ [DEPLOYMENT.md](./DEPLOYMENT.md)

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

### å¯é€‰åŠŸèƒ½æ‰©å±•
- [ ] Redis ç¼“å­˜ï¼ˆæé«˜éªŒè¯æŸ¥è¯¢æ€§èƒ½ï¼‰
- [ ] WebSocket å®æ—¶æ¨é€ï¼ˆç®¡ç†é¢æ¿å®æ—¶æ›´æ–°ï¼‰
- [ ] ç»†ç²’åº¦æƒé™æ§åˆ¶ï¼ˆä¸åŒç”¨æˆ·ä¸åŒåŠŸèƒ½æƒé™ï¼‰
- [ ] æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼ˆCSV/Excelï¼‰
- [ ] é‚®ä»¶é€šçŸ¥ï¼ˆç™½åå•å˜æ›´ã€å¼‚å¸¸ç™»å½•ï¼‰

### å‰ç«¯æ’ä»¶é›†æˆ
- [ ] å®ç° DPAPI Token åŠ å¯†å­˜å‚¨
- [ ] æ·»åŠ  HTTPS å¼ºåˆ¶æ£€æŸ¥
- [ ] å®ç° HMAC è¯·æ±‚ç­¾å
- [ ] æ›´æ–° CLAUDE.md æ–‡æ¡£

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### é‡åˆ°é—®é¢˜ï¼Ÿ

1. **æŸ¥çœ‹æ—¥å¿—**:
   ```bash
   # å¼€å‘æ¨¡å¼
   æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º

   # Docker æ¨¡å¼
   docker-compose logs -f

   # æ—¥å¿—æ–‡ä»¶
   tail -f logs/combined-YYYY-MM-DD.log
   ```

2. **å¸¸è§é—®é¢˜æ’æŸ¥**:
   - å‚è€ƒ [QUICKSTART.md](./QUICKSTART.md) çš„æ•…éšœæ’æŸ¥éƒ¨åˆ†
   - æ£€æŸ¥ `.env` é…ç½®æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ç«¯å£ 3000 æœªè¢«å ç”¨

3. **æäº¤ Issue**:
   - GitHub Issues: è¯¦ç»†æè¿°é—®é¢˜å’Œæ—¥å¿—

---

## ğŸ“„ è®¸å¯è¯

ä¸ XSZToolbox ä¸»é¡¹ç›®ä¿æŒä¸€è‡´ã€‚

---

## ğŸŠ æ€»ç»“

æ‚¨ç°åœ¨æ‹¥æœ‰ä¸€ä¸ª**åŠŸèƒ½å®Œæ•´ã€å®‰å…¨å¯é ã€æ˜“äºéƒ¨ç½²**çš„åç«¯æœåŠ¡ç³»ç»Ÿï¼

### âœ¨ æ ¸å¿ƒäº®ç‚¹

- ğŸš€ **å¼€ç®±å³ç”¨**: 5 åˆ†é’Ÿå¿«é€Ÿå¯åŠ¨
- ğŸ”’ **å®‰å…¨å¯é **: å¤šå±‚å®‰å…¨é˜²æŠ¤ï¼ŒJWT è®¤è¯
- ğŸ“Š **åŠŸèƒ½å®Œæ•´**: ç”¨æˆ·ç®¡ç†ã€ç™½åå•ã€å®¡è®¡æ—¥å¿—
- ğŸ¨ **ç°ä»£åŒ– UI**: ç®€æ´ç¾è§‚çš„ç®¡ç†é¢æ¿
- ğŸ³ **å®¹å™¨åŒ–**: Docker ä¸€é”®éƒ¨ç½²
- ğŸ“š **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„ä½¿ç”¨å’Œéƒ¨ç½²æ–‡æ¡£

### ğŸ¯ å¯æŠ•å…¥ä½¿ç”¨

æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²ç»è¿‡è®¾è®¡å’Œå®ç°ï¼Œå¯ä»¥ï¼š
1. ç«‹å³å¯åŠ¨æµ‹è¯•
2. è¿æ¥å‰ç«¯æ’ä»¶
3. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

**æ„Ÿè°¢ä½¿ç”¨ XSZToolbox åç«¯æœåŠ¡ï¼ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰
